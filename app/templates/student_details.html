{% extends 'layout.html' %}

{% block content %}
<div class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-6">Student Details</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 md:gap-x-12 mb-8 text-gray-700">
                <div class="space-y-4">
                    <p class="text-lg"><span class="font-semibold text-gray-900">Name:</span> {{ student.name }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Reg. Number:</span> {{ student.reg_number }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Class:</span> {{ student.student_class }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Academic Year:</span> {{ student.academic_year }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Date of Birth:</span> {{ student.dob }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Gender:</span> {{ student.gender }}</p>
                </div>
                <div class="space-y-4">
                    <p class="text-lg"><span class="font-semibold text-gray-900">Phone:</span> {{ student.phone }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Email:</span> {{ student.email }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Address:</span> {{ student.address }}</p>
                    <p class="text-lg"><span class="font-semibold text-gray-900">Admission Date:</span> {{ student.admission_date }}</p>
                    <div class="flex items-center text-lg">
                        <span class="font-semibold text-gray-900">Fee Status for {{ current_term }} {{ current_academic_year }}:</span>
                        <span class="ml-2 font-bold px-3 py-1 rounded-full text-sm
                            {% if fee_status == 'Paid' %}bg-green-200 text-green-800{% else %}bg-red-200 text-red-800{% endif %}">
                            {{ fee_status }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-8">
                <a href="{{ url_for('main.make_payment', reg_number=student.reg_number) }}" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 text-center">
                    Make Payment
                </a>
                <a href="{{ url_for('main.edit_student', reg_number=student.reg_number) }}" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 text-center">
                    Edit Student
                </a>
                <a href="{{ url_for('main.students') }}" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 text-center">
                    Back to Student List
                </a>
            </div>

            <!-- Fee Breakdown Section -->
            <div class="mt-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Fee Breakdown</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {% for period, data in fee_breakdown.items() %}
                    <div class="bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200">
                        <h4 class="text-xl font-semibold text-indigo-700 mb-2">{{ period }}</h4>
                        <p class="text-md"><span class="font-medium">Expected:</span> ₦{{ '{:,.2f}'.format(data.expected) }}</p>
                        <p class="text-md"><span class="font-medium">Paid:</span> ₦{{ '{:,.2f}'.format(data.paid) }}</p>
                        <p class="text-md text-red-600"><span class="font-bold">Outstanding:</span> ₦{{ '{:,.2f}'.format(data.outstanding) }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Payments History Section -->
            <div class="mt-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Payment History</h3>
                {% if payments %}
                    <div class="overflow-x-auto rounded-lg shadow-md border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Amount</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Term</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Academic Year</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for payment in payments %}
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₦{{ '{:,.2f}'.format(payment.amount_paid) }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ payment.payment_date }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ payment.term }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ payment.academic_year }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="{{ url_for('main.download_receipt', payment_id=payment.id) }}" class="text-indigo-600 hover:text-indigo-900">Download Receipt</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-gray-500">No payment history found for this student.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
