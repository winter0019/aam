<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage School Fees</title>
    <!-- Use the Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Manage School Fees</h1>
        </div>

        <!-- Flash messages section (controlled by JavaScript) -->
        <div id="flash-messages" class="mb-4"></div>

        <!-- Add New Fee Form -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Add New Fee Record</h2>
            <form id="add-fee-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Class Selection -->
                    <div>
                        <label for="class" class="block text-sm font-medium text-gray-700">Class</label>
                        <select id="class" name="class" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
                            <option value="">Select Class</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <!-- Term Selection -->
                    <div>
                        <label for="term" class="block text-sm font-medium text-gray-700">Term</label>
                        <select id="term" name="term" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
                            <option value="">Select Term</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <!-- Academic Year Selection -->
                    <div>
                        <label for="academic_year" class="block text-sm font-medium text-gray-700">Academic Year</label>
                        <select id="academic_year" name="academic_year" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
                            <option value="">Select Year</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <!-- Amount Input -->
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700">Amount (â‚¦)</label>
                        <input type="number" id="amount" name="amount" step="0.01" min="0" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"
                               placeholder="e.g., 50000.00">
                    </div>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
                        Add Fee
                    </button>
                </div>
            </form>
        </div>

        <!-- Existing Fee Records Table -->
        <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Existing Fee Records</h2>
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Class</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Academic Year</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Term</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                        <th scope="col" class="relative px-6 py-3">
                            <span class="sr-only">Actions</span>
                        </th>
                    </tr>
                </thead>
                <tbody id="fees-table-body" class="bg-white divide-y divide-gray-200">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- DATA AND INITIAL SETUP ---
        // A simple array to simulate a database of fee records.
        let feeRecords = [];
        let classes = ['JSS1', 'JSS2', 'JSS3', 'SSS1', 'SSS2', 'SSS3'];
        let terms = ['First Term', 'Second Term', 'Third Term'];
        let academicYears = ['2023/2024', '2024/2025', '2025/2026', '2026/2027'];

        // --- HELPER FUNCTIONS ---
        /**
         * Formats a number as Nigerian Naira currency.
         * @param {number} amount The amount to format.
         * @returns {string} The formatted currency string.
         */
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-NG', {
                style: 'currency',
                currency: 'NGN'
            }).format(amount);
        }

        /**
         * Displays a temporary flash message to the user.
         * @param {string} message The message to display.
         * @param {string} category The category of the message ('success', 'error', 'info').
         */
        function showFlashMessage(message, category) {
            const flashContainer = document.getElementById('flash-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `p-3 mb-2 rounded-lg text-white transition-opacity duration-500 ease-in-out`;
            if (category === 'success') {
                messageDiv.classList.add('bg-green-500');
            } else if (category === 'error') {
                messageDiv.classList.add('bg-red-500');
            } else {
                messageDiv.classList.add('bg-blue-500');
            }
            messageDiv.textContent = message;
            flashContainer.appendChild(messageDiv);
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => messageDiv.remove(), 500);
            }, 3000);
        }

        /**
         * Renders the table rows based on the current feeRecords array.
         */
        function renderTable() {
            const tableBody = document.getElementById('fees-table-body');
            tableBody.innerHTML = ''; // Clear the existing rows

            if (feeRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No fee records found.</td>`;
                tableBody.appendChild(row);
                return;
            }

            feeRecords.forEach((fee, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${fee.student_class}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${fee.academic_year}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${fee.term}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatCurrency(fee.amount)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="#" onclick="editFee(${index})" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                        <a href="#" onclick="deleteFee(${index})" class="text-red-600 hover:text-red-900 ml-4">Delete</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        /**
         * Populates the select dropdowns with data.
         */
        function populateDropdowns() {
            const classSelect = document.getElementById('class');
            classes.forEach(c => {
                const option = document.createElement('option');
                option.value = c;
                option.textContent = c;
                classSelect.appendChild(option);
            });

            const termSelect = document.getElementById('term');
            terms.forEach(t => {
                const option = document.createElement('option');
                option.value = t;
                option.textContent = t;
                termSelect.appendChild(option);
            });

            const yearSelect = document.getElementById('academic_year');
            academicYears.forEach(y => {
                const option = document.createElement('option');
                option.value = y;
                option.textContent = y;
                yearSelect.appendChild(option);
            });
        }

        // --- EVENT LISTENERS AND MAIN LOGIC ---
        /**
         * Handles form submission to add a new fee record.
         * @param {Event} event The form submit event.
         */
        document.getElementById('add-fee-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const form = event.target;
            const newFee = {
                student_class: form.class.value,
                term: form.term.value,
                academic_year: form.academic_year.value,
                amount: parseFloat(form.amount.value)
            };

            // Simple validation to prevent duplicates
            const isDuplicate = feeRecords.some(fee =>
                fee.student_class === newFee.student_class &&
                fee.term === newFee.term &&
                fee.academic_year === newFee.academic_year
            );

            if (isDuplicate) {
                showFlashMessage('A fee record for this class, term, and year already exists.', 'error');
            } else {
                feeRecords.push(newFee);
                renderTable(); // Re-render the table with the new data
                showFlashMessage('New fee record added successfully!', 'success');
                form.reset(); // Clear the form fields
            }
        });
        
        /**
         * Function to delete a fee record.
         * @param {number} index The index of the record in the feeRecords array.
         */
        function deleteFee(index) {
            // Confirm with the user before deleting
            if (confirm("Are you sure you want to delete this fee record?")) {
                feeRecords.splice(index, 1);
                renderTable();
                showFlashMessage('Fee record deleted successfully!', 'success');
            }
        }
        
        /**
         * Function to edit a fee record.
         * NOTE: This is a simple implementation using a prompt.
         * For a real application, you would use a modal or a separate form.
         * @param {number} index The index of the record in the feeRecords array.
         */
        function editFee(index) {
            const fee = feeRecords[index];
            const newAmount = prompt(`Editing fee for ${fee.student_class} (${fee.term}, ${fee.academic_year}). Enter new amount:`, fee.amount);
            
            if (newAmount !== null && !isNaN(newAmount) && newAmount.trim() !== '') {
                feeRecords[index].amount = parseFloat(newAmount);
                renderTable();
                showFlashMessage('Fee record updated successfully!', 'success');
            } else if (newAmount !== null) {
                showFlashMessage('Invalid amount entered. No changes were made.', 'error');
            }
        }

        // Initial setup on page load
        window.onload = function() {
            populateDropdowns();
            renderTable();
        };
    </script>
</body>
</html>
